"""
fixtures useful for testing a FHIR capability statement. These are based 
on a pre-existing FHIR capability statement and may need to be amended to 
cultivate a complete test set. (remove this comment if that has been done)

"""
import pytest

from capability_statement import get_resource, get_capability_statement

@pytest.mark.capability_statement
# List of structures expected to be found
@pytest.mark.parametrize("resource", ['Account','ActivityDefinition','AdverseEvent','AllergyIntolerance','Appointment','AppointmentResponse','AuditEvent','Basic','Binary','BodySite','Bundle','CapabilityStatement','CarePlan','CareTeam','ChargeItem','Claim','ClaimResponse','ClinicalImpression','CodeSystem','Communication','CommunicationRequest','CompartmentDefinition','Composition','ConceptMap','Condition','Consent','Contract','Coverage','DataElement','DetectedIssue','Device','DeviceComponent','DeviceMetric','DeviceRequest','DeviceUseStatement','DiagnosticReport','DocumentManifest','DocumentReference','EligibilityRequest','EligibilityResponse','Encounter','Endpoint','EnrollmentRequest','EnrollmentResponse','EpisodeOfCare','ExpansionProfile','ExplanationOfBenefit','FamilyMemberHistory','Flag','Goal','GraphDefinition','Group','GuidanceResponse','HealthcareService','ImagingManifest','ImagingStudy','Immunization','ImmunizationRecommendation','ImplementationGuide','Library','Linkage','List','Location','Measure','MeasureReport','Media','Medication','MedicationAdministration','MedicationDispense','MedicationRequest','MedicationStatement','MessageDefinition','MessageHeader','NamingSystem','NutritionOrder','Observation','OperationDefinition','OperationOutcome','Organization','Parameters','Patient','PaymentNotice','PaymentReconciliation','Person','PlanDefinition','Practitioner','PractitionerRole','Procedure','ProcedureRequest','ProcessRequest','ProcessResponse','Provenance','Questionnaire','QuestionnaireResponse','ReferralRequest','RelatedPerson','RequestGroup','ResearchStudy','ResearchSubject','RiskAssessment','Schedule','SearchParameter','Sequence','ServiceDefinition','Slot','Specimen','StructureDefinition','StructureMap','Subscription','Substance','SupplyDelivery','SupplyRequest','Task','TestReport','TestScript','ValueSet','VisionPrescription'])
# interaction types
@pytest.mark.parametrize("include_type", ['history-instance','vread','read','delete','search-type','create','update','history-type'])


def test_resource_interaction(host, resource, include_type):
    capability_statement = get_capability_statement(host)
    #pdb.set_trace()
    assert len(capability_statement['rest']) == 1
    resources = []
    total_resource_list = []

    res = get_resource(host, resource)
    #print(capability_statement['rest'][0]['resource'])
    #resources = [res for res in capability_statement['rest'][0]['resource'] if res['type'] == resource]
    #assert len(resources) == 1

    matching_codes = [ x['code'] for x in res['interaction'] ]
    assert include_type in matching_codes, f"Supports {resource}.{include_type}" 

# Conditional CUD
@pytest.mark.parametrize("conditional_res, conditional_cud", [
	('Account', ('True','True','multiple') ),
	('ActivityDefinition', ('True','True','multiple') ),
	('AdverseEvent', ('True','True','multiple') ),
	('AllergyIntolerance', ('True','True','multiple') ),
	('Appointment', ('True','True','multiple') ),
	('AppointmentResponse', ('True','True','multiple') ),
	('AuditEvent', ('True','True','multiple') ),
	('Basic', ('True','True','multiple') ),
	('Binary', ('True','True','multiple') ),
	('BodySite', ('True','True','multiple') ),
	('Bundle', ('True','True','multiple') ),
	('CapabilityStatement', ('True','True','multiple') ),
	('CarePlan', ('True','True','multiple') ),
	('CareTeam', ('True','True','multiple') ),
	('ChargeItem', ('True','True','multiple') ),
	('Claim', ('True','True','multiple') ),
	('ClaimResponse', ('True','True','multiple') ),
	('ClinicalImpression', ('True','True','multiple') ),
	('CodeSystem', ('True','True','multiple') ),
	('Communication', ('True','True','multiple') ),
	('CommunicationRequest', ('True','True','multiple') ),
	('CompartmentDefinition', ('True','True','multiple') ),
	('Composition', ('True','True','multiple') ),
	('ConceptMap', ('True','True','multiple') ),
	('Condition', ('True','True','multiple') ),
	('Consent', ('True','True','multiple') ),
	('Contract', ('True','True','multiple') ),
	('Coverage', ('True','True','multiple') ),
	('DataElement', ('True','True','multiple') ),
	('DetectedIssue', ('True','True','multiple') ),
	('Device', ('True','True','multiple') ),
	('DeviceComponent', ('True','True','multiple') ),
	('DeviceMetric', ('True','True','multiple') ),
	('DeviceRequest', ('True','True','multiple') ),
	('DeviceUseStatement', ('True','True','multiple') ),
	('DiagnosticReport', ('True','True','multiple') ),
	('DocumentManifest', ('True','True','multiple') ),
	('DocumentReference', ('True','True','multiple') ),
	('EligibilityRequest', ('True','True','multiple') ),
	('EligibilityResponse', ('True','True','multiple') ),
	('Encounter', ('True','True','multiple') ),
	('Endpoint', ('True','True','multiple') ),
	('EnrollmentRequest', ('True','True','multiple') ),
	('EnrollmentResponse', ('True','True','multiple') ),
	('EpisodeOfCare', ('True','True','multiple') ),
	('ExpansionProfile', ('True','True','multiple') ),
	('ExplanationOfBenefit', ('True','True','multiple') ),
	('FamilyMemberHistory', ('True','True','multiple') ),
	('Flag', ('True','True','multiple') ),
	('Goal', ('True','True','multiple') ),
	('GraphDefinition', ('True','True','multiple') ),
	('Group', ('True','True','multiple') ),
	('GuidanceResponse', ('True','True','multiple') ),
	('HealthcareService', ('True','True','multiple') ),
	('ImagingManifest', ('True','True','multiple') ),
	('ImagingStudy', ('True','True','multiple') ),
	('Immunization', ('True','True','multiple') ),
	('ImmunizationRecommendation', ('True','True','multiple') ),
	('ImplementationGuide', ('True','True','multiple') ),
	('Library', ('True','True','multiple') ),
	('Linkage', ('True','True','multiple') ),
	('List', ('True','True','multiple') ),
	('Location', ('True','True','multiple') ),
	('Measure', ('True','True','multiple') ),
	('MeasureReport', ('True','True','multiple') ),
	('Media', ('True','True','multiple') ),
	('Medication', ('True','True','multiple') ),
	('MedicationAdministration', ('True','True','multiple') ),
	('MedicationDispense', ('True','True','multiple') ),
	('MedicationRequest', ('True','True','multiple') ),
	('MedicationStatement', ('True','True','multiple') ),
	('MessageDefinition', ('True','True','multiple') ),
	('MessageHeader', ('True','True','multiple') ),
	('NamingSystem', ('True','True','multiple') ),
	('NutritionOrder', ('True','True','multiple') ),
	('Observation', ('True','True','multiple') ),
	('OperationDefinition', ('True','True','multiple') ),
	('OperationOutcome', ('True','True','multiple') ),
	('Organization', ('True','True','multiple') ),
	('Parameters', ('True','True','multiple') ),
	('Patient', ('True','True','multiple') ),
	('PaymentNotice', ('True','True','multiple') ),
	('PaymentReconciliation', ('True','True','multiple') ),
	('Person', ('True','True','multiple') ),
	('PlanDefinition', ('True','True','multiple') ),
	('Practitioner', ('True','True','multiple') ),
	('PractitionerRole', ('True','True','multiple') ),
	('Procedure', ('True','True','multiple') ),
	('ProcedureRequest', ('True','True','multiple') ),
	('ProcessRequest', ('True','True','multiple') ),
	('ProcessResponse', ('True','True','multiple') ),
	('Provenance', ('True','True','multiple') ),
	('Questionnaire', ('True','True','multiple') ),
	('QuestionnaireResponse', ('True','True','multiple') ),
	('ReferralRequest', ('True','True','multiple') ),
	('RelatedPerson', ('True','True','multiple') ),
	('RequestGroup', ('True','True','multiple') ),
	('ResearchStudy', ('True','True','multiple') ),
	('ResearchSubject', ('True','True','multiple') ),
	('RiskAssessment', ('True','True','multiple') ),
	('Schedule', ('True','True','multiple') ),
	('SearchParameter', ('True','True','multiple') ),
	('Sequence', ('True','True','multiple') ),
	('ServiceDefinition', ('True','True','multiple') ),
	('Slot', ('True','True','multiple') ),
	('Specimen', ('True','True','multiple') ),
	('StructureDefinition', ('True','True','multiple') ),
	('StructureMap', ('True','True','multiple') ),
	('Subscription', ('True','True','multiple') ),
	('Substance', ('True','True','multiple') ),
	('SupplyDelivery', ('True','True','multiple') ),
	('SupplyRequest', ('True','True','multiple') ),
	('Task', ('True','True','multiple') ),
	('TestReport', ('True','True','multiple') ),
	('TestScript', ('True','True','multiple') ),
	('ValueSet', ('True','True','multiple') ),
	('VisionPrescription', ('True','True','multiple') )
])


def test_conditional_cud(host, conditional_res, conditional_cud):
    res = get_resource(host, conditional_res)

    assert str(res['conditionalCreate']) == conditional_cud[0]
    assert str(res['conditionalUpdate']) == conditional_cud[1]
    assert str(res['conditionalDelete']) == conditional_cud[2]

# Search params
@pytest.mark.parametrize("search_res, search_params", [
	('Account', [('balance', 'quantity'),('identifier', 'token'),('name', 'string'),('owner', 'reference'),('patient', 'reference'),('period', 'date'),('status', 'token'),('subject', 'reference'),('type', 'token')]),
	('ActivityDefinition', [('composed-of', 'reference'),('date', 'date'),('depends-on', 'reference'),('derived-from', 'reference'),('description', 'string'),('effective', 'date'),('identifier', 'token'),('jurisdiction', 'token'),('name', 'string'),('predecessor', 'reference'),('publisher', 'string'),('status', 'token'),('successor', 'reference'),('title', 'string'),('topic', 'token'),('url', 'uri'),('version', 'token')]),
	('AdverseEvent', [('category', 'token'),('date', 'date'),('location', 'reference'),('reaction', 'reference'),('recorder', 'reference'),('seriousness', 'token'),('study', 'reference'),('subject', 'reference'),('substance', 'reference'),('type', 'token')]),
	('AllergyIntolerance', [('asserter', 'reference'),('category', 'token'),('clinical-status', 'token'),('code', 'token'),('criticality', 'token'),('date', 'date'),('identifier', 'token'),('last-date', 'date'),('manifestation', 'token'),('onset', 'date'),('patient', 'reference'),('recorder', 'reference'),('route', 'token'),('severity', 'token'),('type', 'token'),('verification-status', 'token')]),
	('Appointment', [('actor', 'reference'),('appointment-type', 'token'),('date', 'date'),('identifier', 'token'),('incomingreferral', 'reference'),('location', 'reference'),('part-status', 'token'),('patient', 'reference'),('practitioner', 'reference'),('service-type', 'token'),('status', 'token')]),
	('AppointmentResponse', [('actor', 'reference'),('appointment', 'reference'),('identifier', 'token'),('location', 'reference'),('part-status', 'token'),('patient', 'reference'),('practitioner', 'reference')]),
	('AuditEvent', [('action', 'token'),('address', 'string'),('agent', 'reference'),('agent-name', 'string'),('agent-role', 'token'),('altid', 'token'),('date', 'date'),('entity', 'reference'),('entity-id', 'token'),('entity-name', 'string'),('entity-role', 'token'),('entity-type', 'token'),('outcome', 'token'),('patient', 'reference'),('policy', 'uri'),('site', 'token'),('source', 'token'),('subtype', 'token'),('type', 'token'),('user', 'token')]),
	('Basic', [('author', 'reference'),('code', 'token'),('created', 'date'),('identifier', 'token'),('patient', 'reference'),('subject', 'reference')]),
	('Binary', [('contenttype', 'token')]),
	('BodySite', [('code', 'token'),('identifier', 'token'),('patient', 'reference')]),
	('Bundle', [('composition', 'reference'),('identifier', 'token'),('message', 'reference'),('type', 'token')]),
	('CapabilityStatement', [('date', 'date'),('description', 'string'),('event', 'token'),('fhirversion', 'token'),('format', 'token'),('guide', 'uri'),('jurisdiction', 'token'),('mode', 'token'),('name', 'string'),('publisher', 'string'),('resource', 'token'),('resource-profile', 'reference'),('security-service', 'token'),('software', 'string'),('status', 'token'),('supported-profile', 'reference'),('title', 'string'),('url', 'uri'),('version', 'token')]),
	('CarePlan', [('activity-code', 'token'),('activity-date', 'date'),('activity-reference', 'reference'),('author-inc', 'reference'),('based-on', 'reference'),('care-team', 'reference'),('category', 'token'),('condition', 'reference'),('context', 'reference'),('date', 'date'),('definition', 'reference'),('encounter', 'reference'),('goal', 'reference'),('identifier', 'token'),('intent', 'token'),('part-of', 'reference'),('patient', 'reference'),('performer', 'reference'),('replaces', 'reference'),('status', 'token'),('subject', 'reference')]),
	('CareTeam', [('category', 'token'),('context', 'reference'),('date', 'date'),('encounter', 'reference'),('identifier', 'token'),('participant', 'reference'),('patient', 'reference'),('status', 'token'),('subject', 'reference')]),
	('ChargeItem', [('account', 'reference'),('code', 'token'),('context', 'reference'),('entered-date', 'date'),('enterer', 'reference'),('factor-override', 'number'),('identifier', 'token'),('occurrence', 'date'),('participant-actor', 'reference'),('participant-role', 'token'),('patient', 'reference'),('performing-organization', 'reference'),('price-override', 'quantity'),('quantity', 'quantity'),('requesting-organization', 'reference'),('service', 'reference'),('subject', 'reference')]),
	('Claim', [('care-team', 'reference'),('created', 'date'),('encounter', 'reference'),('enterer', 'reference'),('facility', 'reference'),('identifier', 'token'),('insurer', 'reference'),('organization', 'reference'),('patient', 'reference'),('payee', 'reference'),('priority', 'token'),('provider', 'reference'),('use', 'token')]),
	('ClaimResponse', [('created', 'date'),('disposition', 'string'),('identifier', 'token'),('insurer', 'reference'),('outcome', 'token'),('patient', 'reference'),('payment-date', 'date'),('request', 'reference'),('request-provider', 'reference')]),
	('ClinicalImpression', [('action', 'reference'),('assessor', 'reference'),('context', 'reference'),('date', 'date'),('finding-code', 'token'),('finding-ref', 'reference'),('identifier', 'token'),('investigation', 'reference'),('patient', 'reference'),('previous', 'reference'),('problem', 'reference'),('status', 'token'),('subject', 'reference')]),
	('CodeSystem', [('code', 'token'),('content-mode', 'token'),('date', 'date'),('description', 'string'),('identifier', 'token'),('jurisdiction', 'token'),('language', 'token'),('name', 'string'),('publisher', 'string'),('status', 'token'),('system', 'uri'),('title', 'string'),('url', 'uri'),('version', 'token')]),
	('Communication', [('based-on', 'reference'),('category', 'token'),('context', 'reference'),('definition', 'reference'),('encounter', 'reference'),('identifier', 'token'),('medium', 'token'),('part-of', 'reference'),('patient', 'reference'),('received', 'date'),('recipient', 'reference'),('sender', 'reference'),('sent', 'date'),('status', 'token'),('subject', 'reference')]),
	('CommunicationRequest', [('authored', 'date'),('based-on', 'reference'),('category', 'token'),('context', 'reference'),('encounter', 'reference'),('group-identifier', 'token'),('identifier', 'token'),('medium', 'token'),('occurrence', 'date'),('patient', 'reference'),('priority', 'token'),('recipient', 'reference'),('replaces', 'reference'),('requester', 'reference'),('sender', 'reference'),('status', 'token'),('subject', 'reference')]),
	('CompartmentDefinition', [('code', 'token'),('date', 'date'),('description', 'string'),('jurisdiction', 'token'),('name', 'string'),('publisher', 'string'),('resource', 'token'),('status', 'token'),('title', 'string'),('url', 'uri')]),
	('Composition', [('attester', 'reference'),('author', 'reference'),('class', 'token'),('confidentiality', 'token'),('context', 'token'),('date', 'date'),('encounter', 'reference'),('entry', 'reference'),('identifier', 'token'),('patient', 'reference'),('period', 'date'),('related-id', 'token'),('related-ref', 'reference'),('section', 'token'),('status', 'token'),('subject', 'reference'),('title', 'string'),('type', 'token')]),
	('ConceptMap', [('date', 'date'),('dependson', 'uri'),('description', 'string'),('identifier', 'token'),('jurisdiction', 'token'),('name', 'string'),('other', 'uri'),('product', 'uri'),('publisher', 'string'),('source', 'reference'),('source-code', 'token'),('source-system', 'uri'),('source-uri', 'reference'),('status', 'token'),('target', 'reference'),('target-code', 'token'),('target-system', 'uri'),('target-uri', 'reference'),('title', 'string'),('url', 'uri'),('version', 'token')]),
	('Condition', [('abatement-age', 'quantity'),('abatement-boolean', 'token'),('abatement-date', 'date'),('abatement-string', 'string'),('asserted-date', 'date'),('asserter', 'reference'),('body-site', 'token'),('category', 'token'),('clinical-status', 'token'),('code', 'token'),('context', 'reference'),('encounter', 'reference'),('evidence', 'token'),('evidence-detail', 'reference'),('identifier', 'token'),('onset-age', 'quantity'),('onset-date', 'date'),('onset-info', 'string'),('patient', 'reference'),('severity', 'token'),('stage', 'token'),('subject', 'reference'),('verification-status', 'token')]),
	('Consent', [('action', 'token'),('actor', 'reference'),('category', 'token'),('consentor', 'reference'),('data', 'reference'),('date', 'date'),('identifier', 'token'),('organization', 'reference'),('patient', 'reference'),('period', 'date'),('purpose', 'token'),('securitylabel', 'token'),('source', 'reference'),('status', 'token')]),
	('Contract', [('agent', 'reference'),('authority', 'reference'),('domain', 'reference'),('identifier', 'token'),('issued', 'date'),('patient', 'reference'),('signer', 'reference'),('subject', 'reference'),('term-topic', 'reference')]),
	('Coverage', [('beneficiary', 'reference'),('class', 'string'),('dependent', 'string'),('group', 'string'),('identifier', 'token'),('payor', 'reference'),('plan', 'string'),('policy-holder', 'reference'),('sequence', 'string'),('subclass', 'string'),('subgroup', 'string'),('subplan', 'string'),('subscriber', 'reference'),('type', 'token')]),
	('DataElement', [('code', 'token'),('date', 'date'),('description', 'string'),('identifier', 'token'),('jurisdiction', 'token'),('name', 'string'),('publisher', 'string'),('status', 'token'),('stringency', 'token'),('title', 'string'),('url', 'uri'),('version', 'token')]),
	('DetectedIssue', [('author', 'reference'),('category', 'token'),('date', 'date'),('identifier', 'token'),('implicated', 'reference'),('patient', 'reference')]),
	('Device', [('device-name', 'string'),('identifier', 'token'),('location', 'reference'),('manufacturer', 'string'),('model', 'string'),('organization', 'reference'),('patient', 'reference'),('status', 'token'),('type', 'token'),('udi-carrier', 'string'),('udi-di', 'string'),('url', 'uri')]),
	('DeviceComponent', [('identifier', 'token'),('parent', 'reference'),('source', 'reference'),('type', 'token')]),
	('DeviceMetric', [('category', 'token'),('identifier', 'token'),('parent', 'reference'),('source', 'reference'),('type', 'token')]),
	('DeviceRequest', [('authored-on', 'date'),('based-on', 'reference'),('code', 'token'),('definition', 'reference'),('device', 'reference'),('encounter', 'reference'),('event-date', 'date'),('group-identifier', 'token'),('identifier', 'token'),('intent', 'token'),('patient', 'reference'),('performer', 'reference'),('priorrequest', 'reference'),('requester', 'reference'),('status', 'token'),('subject', 'reference')]),
	('DeviceUseStatement', [('device', 'reference'),('identifier', 'token'),('patient', 'reference'),('subject', 'reference')]),
	('DiagnosticReport', [('based-on', 'reference'),('category', 'token'),('code', 'token'),('context', 'reference'),('date', 'date'),('diagnosis', 'token'),('encounter', 'reference'),('identifier', 'token'),('image', 'reference'),('issued', 'date'),('patient', 'reference'),('performer', 'reference'),('result', 'reference'),('specimen', 'reference'),('status', 'token'),('subject', 'reference')]),
	('DocumentManifest', [('author', 'reference'),('content-ref', 'reference'),('created', 'date'),('description', 'string'),('identifier', 'token'),('patient', 'reference'),('recipient', 'reference'),('related-id', 'token'),('related-ref', 'reference'),('source', 'uri'),('status', 'token'),('subject', 'reference'),('type', 'token')]),
	('DocumentReference', [('authenticator', 'reference'),('author', 'reference'),('class', 'token'),('created', 'date'),('custodian', 'reference'),('description', 'string'),('encounter', 'reference'),('event', 'token'),('facility', 'token'),('format', 'token'),('identifier', 'token'),('indexed', 'date'),('language', 'token'),('location', 'uri'),('patient', 'reference'),('period', 'date'),('related-id', 'token'),('related-ref', 'reference'),('relatesto', 'reference'),('relation', 'token'),('relationship', 'composite'),('securitylabel', 'token'),('setting', 'token'),('status', 'token'),('subject', 'reference'),('type', 'token')]),
	('EligibilityRequest', [('created', 'date'),('enterer', 'reference'),('facility', 'reference'),('identifier', 'token'),('organization', 'reference'),('patient', 'reference'),('provider', 'reference')]),
	('EligibilityResponse', [('created', 'date'),('disposition', 'string'),('identifier', 'token'),('insurer', 'reference'),('outcome', 'token'),('request', 'reference'),('request-organization', 'reference'),('request-provider', 'reference')]),
	('Encounter', [('appointment', 'reference'),('class', 'token'),('date', 'date'),('diagnosis', 'reference'),('episodeofcare', 'reference'),('identifier', 'token'),('incomingreferral', 'reference'),('length', 'quantity'),('location', 'reference'),('location-period', 'date'),('part-of', 'reference'),('participant', 'reference'),('participant-type', 'token'),('patient', 'reference'),('practitioner', 'reference'),('reason', 'token'),('service-provider', 'reference'),('special-arrangement', 'token'),('status', 'token'),('subject', 'reference'),('type', 'token')]),
	('Endpoint', [('connection-type', 'token'),('identifier', 'token'),('name', 'string'),('organization', 'reference'),('payload-type', 'token'),('status', 'token')]),
	('EnrollmentRequest', [('identifier', 'token'),('organization', 'reference'),('patient', 'reference'),('subject', 'reference')]),
	('EnrollmentResponse', [('identifier', 'token'),('organization', 'reference'),('request', 'reference')]),
	('EpisodeOfCare', [('care-manager', 'reference'),('condition', 'reference'),('date', 'date'),('identifier', 'token'),('incomingreferral', 'reference'),('organization', 'reference'),('patient', 'reference'),('status', 'token'),('type', 'token')]),
	('ExpansionProfile', [('date', 'date'),('description', 'string'),('identifier', 'token'),('jurisdiction', 'token'),('name', 'string'),('publisher', 'string'),('status', 'token'),('url', 'uri'),('version', 'token')]),
	('ExplanationOfBenefit', [('care-team', 'reference'),('claim', 'reference'),('coverage', 'reference'),('created', 'date'),('disposition', 'string'),('encounter', 'reference'),('enterer', 'reference'),('facility', 'reference'),('identifier', 'token'),('organization', 'reference'),('patient', 'reference'),('payee', 'reference'),('provider', 'reference')]),
	('FamilyMemberHistory', [('code', 'token'),('date', 'date'),('definition', 'reference'),('gender', 'token'),('identifier', 'token'),('patient', 'reference'),('relationship', 'token'),('status', 'token')]),
	('Flag', [('author', 'reference'),('date', 'date'),('encounter', 'reference'),('identifier', 'token'),('patient', 'reference'),('subject', 'reference')]),
	('Goal', [('category', 'token'),('identifier', 'token'),('patient', 'reference'),('start-date', 'date'),('status', 'token'),('subject', 'reference'),('target-date', 'date')]),
	('GraphDefinition', [('date', 'date'),('description', 'string'),('jurisdiction', 'token'),('name', 'string'),('publisher', 'string'),('start', 'token'),('status', 'token'),('url', 'uri'),('version', 'token')]),
	('Group', [('actual', 'token'),('characteristic', 'token'),('characteristic-value', 'composite'),('code', 'token'),('exclude', 'token'),('identifier', 'token'),('member', 'reference'),('type', 'token'),('value', 'token')]),
	('GuidanceResponse', [('identifier', 'token'),('patient', 'reference'),('request', 'token'),('subject', 'reference')]),
	('HealthcareService', [('active', 'token'),('category', 'token'),('characteristic', 'token'),('endpoint', 'reference'),('identifier', 'token'),('location', 'reference'),('name', 'string'),('organization', 'reference'),('programname', 'string'),('type', 'token')]),
	('ImagingManifest', [('author', 'reference'),('authoring-time', 'date'),('endpoint', 'reference'),('identifier', 'token'),('imaging-study', 'reference'),('patient', 'reference'),('selected-study', 'uri')]),
	('ImagingStudy', [('accession', 'token'),('basedon', 'reference'),('bodysite', 'token'),('context', 'reference'),('dicom-class', 'uri'),('endpoint', 'reference'),('identifier', 'token'),('modality', 'token'),('patient', 'reference'),('performer', 'reference'),('reason', 'token'),('series', 'uri'),('started', 'date'),('study', 'uri'),('uid', 'uri')]),
	('Immunization', [('date', 'date'),('dose-sequence', 'number'),('identifier', 'token'),('location', 'reference'),('lot-number', 'string'),('manufacturer', 'reference'),('notgiven', 'token'),('patient', 'reference'),('practitioner', 'reference'),('reaction', 'reference'),('reaction-date', 'date'),('reason', 'token'),('reason-not-given', 'token'),('status', 'token'),('vaccine-code', 'token')]),
	('ImmunizationRecommendation', [('date', 'date'),('dose-number', 'number'),('dose-sequence', 'number'),('identifier', 'token'),('information', 'reference'),('patient', 'reference'),('status', 'token'),('support', 'reference'),('target-disease', 'token'),('vaccine-type', 'token')]),
	('ImplementationGuide', [('date', 'date'),('dependency', 'uri'),('description', 'string'),('experimental', 'token'),('jurisdiction', 'token'),('name', 'string'),('publisher', 'string'),('resource', 'reference'),('status', 'token'),('url', 'uri'),('version', 'token')]),
	('Library', [('composed-of', 'reference'),('date', 'date'),('depends-on', 'reference'),('derived-from', 'reference'),('description', 'string'),('effective', 'date'),('identifier', 'token'),('jurisdiction', 'token'),('name', 'string'),('predecessor', 'reference'),('publisher', 'string'),('status', 'token'),('successor', 'reference'),('title', 'string'),('topic', 'token'),('url', 'uri'),('version', 'token')]),
	('Linkage', [('author', 'reference')]),
	('List', [('code', 'token'),('date', 'date'),('empty-reason', 'token'),('encounter', 'reference'),('identifier', 'token'),('item', 'reference'),('notes', 'string'),('patient', 'reference'),('source', 'reference'),('status', 'token'),('subject', 'reference'),('title', 'string')]),
	('Location', [('address', 'string'),('address-city', 'string'),('address-country', 'string'),('address-postalcode', 'string'),('address-state', 'string'),('address-use', 'token'),('endpoint', 'reference'),('identifier', 'token'),('name', 'string'),('near', 'token'),('near-distance', 'quantity'),('operational-status', 'token'),('organization', 'reference'),('partof', 'reference'),('status', 'token'),('type', 'token')]),
	('Measure', [('composed-of', 'reference'),('date', 'date'),('depends-on', 'reference'),('derived-from', 'reference'),('description', 'string'),('effective', 'date'),('identifier', 'token'),('jurisdiction', 'token'),('name', 'string'),('predecessor', 'reference'),('publisher', 'string'),('status', 'token'),('successor', 'reference'),('title', 'string'),('topic', 'token'),('url', 'uri'),('version', 'token')]),
	('MeasureReport', [('identifier', 'token'),('patient', 'reference'),('status', 'token')]),
	('Media', [('based-on', 'reference'),('context', 'reference'),('created', 'date'),('date', 'date'),('device', 'reference'),('identifier', 'token'),('operator', 'reference'),('patient', 'reference'),('site', 'token'),('subject', 'reference'),('subtype', 'token'),('type', 'token'),('view', 'token')]),
	('Medication', [('code', 'token'),('container', 'token'),('form', 'token'),('ingredient', 'reference'),('ingredient-code', 'token'),('manufacturer', 'reference'),('over-the-counter', 'token'),('package-item', 'reference'),('package-item-code', 'token'),('status', 'token')]),
	('MedicationAdministration', [('category', 'token'),('code', 'token'),('context', 'reference'),('device', 'reference'),('effective-time', 'date'),('identifier', 'token'),('medication', 'reference'),('not-given', 'token'),('patient', 'reference'),('performer', 'reference'),('prescription', 'reference'),('reason-given', 'token'),('reason-not-given', 'token'),('status', 'token'),('subject', 'reference')]),
	('MedicationDispense', [('category', 'token'),('code', 'token'),('context', 'reference'),('destination', 'reference'),('identifier', 'token'),('medication', 'reference'),('patient', 'reference'),('performer', 'reference'),('periodofuse', 'date'),('prescription', 'reference'),('receiver', 'reference'),('responsibleparty', 'reference'),('status', 'token'),('subject', 'reference'),('type', 'token'),('whenhandedover', 'date'),('whenprepared', 'date')]),
	('MedicationRequest', [('authoredon', 'date'),('category', 'token'),('code', 'token'),('context', 'reference'),('date', 'date'),('identifier', 'token'),('intended-dispenser', 'reference'),('intent', 'token'),('medication', 'reference'),('patient', 'reference'),('periodofuse', 'date'),('priority', 'token'),('requester', 'reference'),('status', 'token'),('subject', 'reference')]),
	('MedicationStatement', [('category', 'token'),('code', 'token'),('context', 'reference'),('effective', 'date'),('identifier', 'token'),('medication', 'reference'),('part-of', 'reference'),('patient', 'reference'),('source', 'reference'),('status', 'token'),('subject', 'reference')]),
	('MessageDefinition', [('category', 'token'),('date', 'date'),('description', 'string'),('event', 'token'),('focus', 'token'),('identifier', 'token'),('jurisdiction', 'token'),('name', 'string'),('publisher', 'string'),('status', 'token'),('title', 'string'),('url', 'uri'),('version', 'token')]),
	('MessageHeader', [('author', 'reference'),('code', 'token'),('destination', 'string'),('destination-uri', 'uri'),('enterer', 'reference'),('event', 'token'),('focus', 'reference'),('receiver', 'reference'),('response-id', 'token'),('responsible', 'reference'),('sender', 'reference'),('source', 'string'),('source-uri', 'uri'),('target', 'reference'),('timestamp', 'date')]),
	('NamingSystem', [('contact', 'string'),('date', 'date'),('description', 'string'),('id-type', 'token'),('jurisdiction', 'token'),('kind', 'token'),('name', 'string'),('period', 'date'),('publisher', 'string'),('replaced-by', 'reference'),('responsible', 'string'),('status', 'token'),('telecom', 'token'),('type', 'token'),('value', 'string')]),
	('NutritionOrder', [('additive', 'token'),('datetime', 'date'),('encounter', 'reference'),('formula', 'token'),('identifier', 'token'),('oraldiet', 'token'),('patient', 'reference'),('provider', 'reference'),('status', 'token'),('supplement', 'token')]),
	('Observation', [('based-on', 'reference'),('category', 'token'),('code', 'token'),('code-value-concept', 'composite'),('code-value-date', 'composite'),('code-value-quantity', 'composite'),('code-value-string', 'composite'),('combo-code', 'token'),('combo-code-value-concept', 'composite'),('combo-code-value-quantity', 'composite'),('combo-data-absent-reason', 'token'),('combo-value-concept', 'token'),('combo-value-quantity', 'quantity'),('component-code', 'token'),('component-code-value-concept', 'composite'),('component-code-value-quantity', 'composite'),('component-data-absent-reason', 'token'),('component-value-concept', 'token'),('component-value-quantity', 'quantity'),('context', 'reference'),('data-absent-reason', 'token'),('date', 'date'),('device', 'reference'),('encounter', 'reference'),('identifier', 'token'),('method', 'token'),('patient', 'reference'),('performer', 'reference'),('related', 'composite'),('related-target', 'reference'),('related-type', 'token'),('specimen', 'reference'),('status', 'token'),('subject', 'reference'),('value-concept', 'token'),('value-date', 'date'),('value-quantity', 'quantity'),('value-string', 'string')]),
	('OperationDefinition', [('base', 'reference'),('code', 'token'),('date', 'date'),('description', 'string'),('instance', 'token'),('jurisdiction', 'token'),('kind', 'token'),('name', 'string'),('param-profile', 'reference'),('publisher', 'string'),('status', 'token'),('system', 'token'),('type', 'token'),('url', 'uri'),('version', 'token')]),
	('OperationOutcome', []),
	('Organization', [('active', 'token'),('address', 'string'),('address-city', 'string'),('address-country', 'string'),('address-postalcode', 'string'),('address-state', 'string'),('address-use', 'token'),('endpoint', 'reference'),('identifier', 'token'),('name', 'string'),('partof', 'reference'),('phonetic', 'string'),('type', 'token')]),
	('Parameters', []),
	('Patient', [('active', 'token'),('address', 'string'),('address-city', 'string'),('address-country', 'string'),('address-postalcode', 'string'),('address-state', 'string'),('address-use', 'token'),('animal-breed', 'token'),('animal-species', 'token'),('birthdate', 'date'),('death-date', 'date'),('deceased', 'token'),('email', 'token'),('family', 'string'),('gender', 'token'),('general-practitioner', 'reference'),('given', 'string'),('identifier', 'token'),('language', 'token'),('link', 'reference'),('name', 'string'),('organization', 'reference'),('phone', 'token'),('phonetic', 'string'),('telecom', 'token')]),
	('PaymentNotice', [('created', 'date'),('identifier', 'token'),('organization', 'reference'),('payment-status', 'token'),('provider', 'reference'),('request', 'reference'),('response', 'reference'),('statusdate', 'date')]),
	('PaymentReconciliation', [('created', 'date'),('disposition', 'string'),('identifier', 'token'),('organization', 'reference'),('outcome', 'token'),('request', 'reference'),('request-organization', 'reference'),('request-provider', 'reference')]),
	('Person', [('address', 'string'),('address-city', 'string'),('address-country', 'string'),('address-postalcode', 'string'),('address-state', 'string'),('address-use', 'token'),('birthdate', 'date'),('email', 'token'),('gender', 'token'),('identifier', 'token'),('link', 'reference'),('name', 'string'),('organization', 'reference'),('patient', 'reference'),('phone', 'token'),('phonetic', 'string'),('practitioner', 'reference'),('relatedperson', 'reference'),('telecom', 'token')]),
	('PlanDefinition', [('composed-of', 'reference'),('date', 'date'),('depends-on', 'reference'),('derived-from', 'reference'),('description', 'string'),('effective', 'date'),('identifier', 'token'),('jurisdiction', 'token'),('name', 'string'),('predecessor', 'reference'),('publisher', 'string'),('status', 'token'),('successor', 'reference'),('title', 'string'),('topic', 'token'),('url', 'uri'),('version', 'token')]),
	('Practitioner', [('active', 'token'),('address', 'string'),('address-city', 'string'),('address-country', 'string'),('address-postalcode', 'string'),('address-state', 'string'),('address-use', 'token'),('communication', 'token'),('email', 'token'),('family', 'string'),('gender', 'token'),('given', 'string'),('identifier', 'token'),('name', 'string'),('phone', 'token'),('phonetic', 'string'),('telecom', 'token')]),
	('PractitionerRole', [('active', 'token'),('date', 'date'),('email', 'token'),('endpoint', 'reference'),('identifier', 'token'),('location', 'reference'),('organization', 'reference'),('phone', 'token'),('practitioner', 'reference'),('role', 'token'),('service', 'reference'),('specialty', 'token'),('telecom', 'token')]),
	('Procedure', [('based-on', 'reference'),('category', 'token'),('code', 'token'),('context', 'reference'),('date', 'date'),('definition', 'reference'),('encounter', 'reference'),('identifier', 'token'),('location', 'reference'),('part-of', 'reference'),('patient', 'reference'),('performer', 'reference'),('status', 'token'),('subject', 'reference')]),
	('ProcedureRequest', [('authored', 'date'),('based-on', 'reference'),('body-site', 'token'),('code', 'token'),('context', 'reference'),('definition', 'reference'),('encounter', 'reference'),('identifier', 'token'),('intent', 'token'),('occurrence', 'date'),('patient', 'reference'),('performer', 'reference'),('performer-type', 'token'),('priority', 'token'),('replaces', 'reference'),('requester', 'reference'),('requisition', 'token'),('specimen', 'reference'),('status', 'token'),('subject', 'reference')]),
	('ProcessRequest', [('action', 'token'),('identifier', 'token'),('organization', 'reference'),('provider', 'reference')]),
	('ProcessResponse', [('identifier', 'token'),('organization', 'reference'),('request', 'reference'),('request-organization', 'reference'),('request-provider', 'reference')]),
	('Provenance', [('agent', 'reference'),('agent-role', 'token'),('end', 'date'),('entity-id', 'token'),('entity-ref', 'reference'),('location', 'reference'),('patient', 'reference'),('recorded', 'date'),('signature-type', 'token'),('start', 'date'),('target', 'reference')]),
	('Questionnaire', [('code', 'token'),('date', 'date'),('description', 'string'),('effective', 'date'),('identifier', 'token'),('jurisdiction', 'token'),('name', 'string'),('publisher', 'string'),('status', 'token'),('title', 'string'),('url', 'uri'),('version', 'token')]),
	('QuestionnaireResponse', [('author', 'reference'),('authored', 'date'),('based-on', 'reference'),('context', 'reference'),('identifier', 'token'),('parent', 'reference'),('patient', 'reference'),('questionnaire', 'reference'),('source', 'reference'),('status', 'token'),('subject', 'reference')]),
	('ReferralRequest', [('authored-on', 'date'),('based-on', 'reference'),('context', 'reference'),('definition', 'reference'),('encounter', 'reference'),('group-identifier', 'token'),('identifier', 'token'),('intent', 'token'),('occurrence-date', 'date'),('patient', 'reference'),('priority', 'token'),('recipient', 'reference'),('replaces', 'reference'),('requester', 'reference'),('service', 'token'),('specialty', 'token'),('status', 'token'),('subject', 'reference'),('type', 'token')]),
	('RelatedPerson', [('active', 'token'),('address', 'string'),('address-city', 'string'),('address-country', 'string'),('address-postalcode', 'string'),('address-state', 'string'),('address-use', 'token'),('birthdate', 'date'),('email', 'token'),('gender', 'token'),('identifier', 'token'),('name', 'string'),('patient', 'reference'),('phone', 'token'),('phonetic', 'string'),('telecom', 'token')]),
	('RequestGroup', [('author', 'reference'),('authored', 'date'),('context', 'reference'),('definition', 'reference'),('encounter', 'reference'),('group-identifier', 'token'),('identifier', 'token'),('intent', 'token'),('participant', 'reference'),('patient', 'reference'),('priority', 'token'),('status', 'token'),('subject', 'reference')]),
	('ResearchStudy', [('category', 'token'),('date', 'date'),('focus', 'token'),('identifier', 'token'),('jurisdiction', 'token'),('keyword', 'token'),('partof', 'reference'),('principalinvestigator', 'reference'),('protocol', 'reference'),('site', 'reference'),('sponsor', 'reference'),('status', 'token'),('title', 'string')]),
	('ResearchSubject', [('date', 'date'),('identifier', 'token'),('individual', 'reference'),('patient', 'reference'),('status', 'token')]),
	('RiskAssessment', [('condition', 'reference'),('date', 'date'),('encounter', 'reference'),('identifier', 'token'),('method', 'token'),('patient', 'reference'),('performer', 'reference'),('probability', 'number'),('risk', 'token'),('subject', 'reference')]),
	('Schedule', [('active', 'token'),('actor', 'reference'),('date', 'date'),('identifier', 'token'),('type', 'token')]),
	('SearchParameter', [('base', 'token'),('code', 'token'),('component', 'reference'),('date', 'date'),('derived-from', 'uri'),('description', 'string'),('jurisdiction', 'token'),('name', 'string'),('publisher', 'string'),('status', 'token'),('target', 'token'),('type', 'token'),('url', 'uri'),('version', 'token')]),
	('Sequence', [('chromosome', 'token'),('coordinate', 'composite'),('end', 'number'),('identifier', 'token'),('patient', 'reference'),('start', 'number'),('type', 'token')]),
	('ServiceDefinition', [('composed-of', 'reference'),('date', 'date'),('depends-on', 'reference'),('derived-from', 'reference'),('description', 'string'),('effective', 'date'),('identifier', 'token'),('jurisdiction', 'token'),('name', 'string'),('predecessor', 'reference'),('publisher', 'string'),('status', 'token'),('successor', 'reference'),('title', 'string'),('topic', 'token'),('url', 'uri'),('version', 'token')]),
	('Slot', [('identifier', 'token'),('schedule', 'reference'),('slot-type', 'token'),('start', 'date'),('status', 'token')]),
	('Specimen', [('accession', 'token'),('bodysite', 'token'),('collected', 'date'),('collector', 'reference'),('container', 'token'),('container-id', 'token'),('identifier', 'token'),('parent', 'reference'),('patient', 'reference'),('status', 'token'),('subject', 'reference'),('type', 'token')]),
	('StructureDefinition', [('abstract', 'token'),('base', 'uri'),('base-path', 'token'),('context-type', 'token'),('date', 'date'),('derivation', 'token'),('description', 'string'),('experimental', 'token'),('ext-context', 'string'),('identifier', 'token'),('jurisdiction', 'token'),('keyword', 'token'),('kind', 'token'),('name', 'string'),('path', 'token'),('publisher', 'string'),('status', 'token'),('title', 'string'),('type', 'token'),('url', 'uri'),('valueset', 'reference'),('version', 'token')]),
	('StructureMap', [('date', 'date'),('description', 'string'),('identifier', 'token'),('jurisdiction', 'token'),('name', 'string'),('publisher', 'string'),('status', 'token'),('title', 'string'),('url', 'uri'),('version', 'token')]),
	('Subscription', [('add-tag', 'token'),('contact', 'token'),('criteria', 'string'),('payload', 'string'),('status', 'token'),('type', 'token'),('url', 'uri')]),
	('Substance', [('category', 'token'),('code', 'token'),('container-identifier', 'token'),('expiry', 'date'),('identifier', 'token'),('quantity', 'quantity'),('status', 'token'),('substance-reference', 'reference')]),
	('SupplyDelivery', [('identifier', 'token'),('patient', 'reference'),('receiver', 'reference'),('status', 'token'),('supplier', 'reference')]),
	('SupplyRequest', [('category', 'token'),('date', 'date'),('identifier', 'token'),('requester', 'reference'),('status', 'token'),('supplier', 'reference')]),
	('Task', [('authored-on', 'date'),('based-on', 'reference'),('business-status', 'token'),('code', 'token'),('context', 'reference'),('focus', 'reference'),('group-identifier', 'token'),('identifier', 'token'),('intent', 'token'),('modified', 'date'),('organization', 'reference'),('owner', 'reference'),('part-of', 'reference'),('patient', 'reference'),('performer', 'token'),('period', 'date'),('priority', 'token'),('requester', 'reference'),('status', 'token'),('subject', 'reference')]),
	('TestReport', [('identifier', 'token'),('issued', 'date'),('participant', 'uri'),('result', 'token'),('tester', 'string'),('testscript', 'reference')]),
	('TestScript', [('date', 'date'),('description', 'string'),('identifier', 'token'),('jurisdiction', 'token'),('name', 'string'),('publisher', 'string'),('status', 'token'),('testscript-capability', 'string'),('title', 'string'),('url', 'uri'),('version', 'token')]),
	('ValueSet', [('date', 'date'),('description', 'string'),('expansion', 'uri'),('identifier', 'token'),('jurisdiction', 'token'),('name', 'string'),('publisher', 'string'),('reference', 'uri'),('status', 'token'),('title', 'string'),('url', 'uri'),('version', 'token')]),
	('VisionPrescription', [('datewritten', 'date'),('encounter', 'reference'),('identifier', 'token'),('patient', 'reference'),('prescriber', 'reference')])
])


def test_search_params(host, search_res, search_params):
    res = get_resource(host, search_res)

    params = {}
    for sp in res['searchParam']:
        params[sp['name']]  = sp['type']

    for (sname, stype) in search_params:
        assert stype == params[sname], f"searchParam {sname} is {stype}"

# searchInclude
@pytest.mark.parametrize("si_res, search_includes", [
	('Account', ['Account:patient', 'Account:subject', 'Account:owner']),
	('ActivityDefinition', ['ActivityDefinition:successor', 'ActivityDefinition:predecessor', 'ActivityDefinition:derived-from', 'ActivityDefinition:depends-on', 'ActivityDefinition:composed-of']),
	('AdverseEvent', ['AdverseEvent:substance', 'AdverseEvent:subject', 'AdverseEvent:study', 'AdverseEvent:location', 'AdverseEvent:reaction', 'AdverseEvent:recorder']),
	('AllergyIntolerance', ['AllergyIntolerance:patient', 'AllergyIntolerance:recorder', 'AllergyIntolerance:asserter']),
	('Appointment', ['Appointment:practitioner', 'Appointment:patient', 'Appointment:location', 'Appointment:incomingreferral', 'Appointment:actor']),
	('AppointmentResponse', ['AppointmentResponse:location', 'AppointmentResponse:patient', 'AppointmentResponse:practitioner', 'AppointmentResponse:actor', 'AppointmentResponse:appointment']),
	('AuditEvent', ['AuditEvent:patient', 'AuditEvent:entity', 'AuditEvent:agent']),
	('Basic', ['Basic:patient', 'Basic:subject', 'Basic:author']),
	('Binary', []),
	('BodySite', ['BodySite:patient']),
	('Bundle', ['Bundle:message', 'Bundle:composition']),
	('CapabilityStatement', ['CapabilityStatement:supported-profile', 'CapabilityStatement:resource-profile']),
	('CarePlan', ['CarePlan:patient', 'CarePlan:subject', 'CarePlan:part-of', 'CarePlan:replaces', 'CarePlan:context', 'CarePlan:performer', 'CarePlan:condition', 'CarePlan:encounter', 'CarePlan:goal', 'CarePlan:definition', 'CarePlan:care-team', 'CarePlan:activity-reference', 'CarePlan:based-on', 'CarePlan:author-inc']),
	('CareTeam', ['CareTeam:patient', 'CareTeam:subject', 'CareTeam:context', 'CareTeam:participant', 'CareTeam:encounter']),
	('ChargeItem', ['ChargeItem:requesting-organization', 'ChargeItem:subject', 'ChargeItem:service', 'ChargeItem:performing-organization', 'ChargeItem:participant-actor', 'ChargeItem:patient', 'ChargeItem:enterer', 'ChargeItem:account', 'ChargeItem:context']),
	('Claim', ['Claim:insurer', 'Claim:payee', 'Claim:patient', 'Claim:organization', 'Claim:facility', 'Claim:provider', 'Claim:enterer', 'Claim:encounter', 'Claim:care-team']),
	('ClaimResponse', ['ClaimResponse:request', 'ClaimResponse:insurer', 'ClaimResponse:request-provider', 'ClaimResponse:patient']),
	('ClinicalImpression', ['ClinicalImpression:patient', 'ClinicalImpression:subject', 'ClinicalImpression:problem', 'ClinicalImpression:previous', 'ClinicalImpression:investigation', 'ClinicalImpression:finding-ref', 'ClinicalImpression:context', 'ClinicalImpression:assessor', 'ClinicalImpression:action']),
	('CodeSystem', []),
	('Communication', ['Communication:subject', 'Communication:encounter', 'Communication:sender', 'Communication:patient', 'Communication:recipient', 'Communication:part-of', 'Communication:definition', 'Communication:based-on', 'Communication:context']),
	('CommunicationRequest', ['CommunicationRequest:subject', 'CommunicationRequest:replaces', 'CommunicationRequest:recipient', 'CommunicationRequest:requester', 'CommunicationRequest:sender', 'CommunicationRequest:patient', 'CommunicationRequest:context', 'CommunicationRequest:encounter', 'CommunicationRequest:based-on']),
	('CompartmentDefinition', []),
	('Composition', ['Composition:patient', 'Composition:subject', 'Composition:related-ref', 'Composition:entry', 'Composition:attester', 'Composition:author', 'Composition:encounter']),
	('ConceptMap', ['ConceptMap:source', 'ConceptMap:source-uri', 'ConceptMap:target', 'ConceptMap:target-uri']),
	('Condition', ['Condition:patient', 'Condition:subject', 'Condition:encounter', 'Condition:context', 'Condition:evidence-detail', 'Condition:asserter']),
	('Consent', ['Consent:patient', 'Consent:source', 'Consent:organization', 'Consent:consentor', 'Consent:data', 'Consent:actor']),
	('Contract', ['Contract:term-topic', 'Contract:subject', 'Contract:domain', 'Contract:patient', 'Contract:agent', 'Contract:signer', 'Contract:authority']),
	('Coverage', ['Coverage:subscriber', 'Coverage:policy-holder', 'Coverage:payor', 'Coverage:beneficiary']),
	('DataElement', []),
	('DetectedIssue', ['DetectedIssue:patient', 'DetectedIssue:author', 'DetectedIssue:implicated']),
	('Device', ['Device:organization', 'Device:patient', 'Device:location']),
	('DeviceComponent', ['DeviceComponent:source', 'DeviceComponent:parent']),
	('DeviceMetric', ['DeviceMetric:source', 'DeviceMetric:parent']),
	('DeviceRequest', ['DeviceRequest:patient', 'DeviceRequest:performer', 'DeviceRequest:subject', 'DeviceRequest:requester', 'DeviceRequest:priorrequest', 'DeviceRequest:definition', 'DeviceRequest:device', 'DeviceRequest:based-on', 'DeviceRequest:encounter']),
	('DeviceUseStatement', ['DeviceUseStatement:patient', 'DeviceUseStatement:subject', 'DeviceUseStatement:device']),
	('DiagnosticReport', ['DiagnosticReport:patient', 'DiagnosticReport:result', 'DiagnosticReport:subject', 'DiagnosticReport:image', 'DiagnosticReport:specimen', 'DiagnosticReport:performer', 'DiagnosticReport:context', 'DiagnosticReport:based-on', 'DiagnosticReport:encounter']),
	('DocumentManifest', ['DocumentManifest:patient', 'DocumentManifest:related-ref', 'DocumentManifest:subject', 'DocumentManifest:recipient', 'DocumentManifest:content-ref', 'DocumentManifest:author']),
	('DocumentReference', ['DocumentReference:patient', 'DocumentReference:subject', 'DocumentReference:related-ref', 'DocumentReference:relatesto', 'DocumentReference:custodian', 'DocumentReference:author', 'DocumentReference:authenticator', 'DocumentReference:encounter']),
	('EligibilityRequest', ['EligibilityRequest:patient', 'EligibilityRequest:organization', 'EligibilityRequest:provider', 'EligibilityRequest:facility', 'EligibilityRequest:enterer']),
	('EligibilityResponse', ['EligibilityResponse:request-organization', 'EligibilityResponse:request-provider', 'EligibilityResponse:request', 'EligibilityResponse:insurer']),
	('Encounter', ['Encounter:patient', 'Encounter:service-provider', 'Encounter:subject', 'Encounter:practitioner', 'Encounter:participant', 'Encounter:part-of', 'Encounter:location', 'Encounter:episodeofcare', 'Encounter:diagnosis', 'Encounter:incomingreferral', 'Encounter:appointment']),
	('Endpoint', ['Endpoint:organization']),
	('EnrollmentRequest', ['EnrollmentRequest:patient', 'EnrollmentRequest:subject', 'EnrollmentRequest:organization']),
	('EnrollmentResponse', ['EnrollmentResponse:request', 'EnrollmentResponse:organization']),
	('EpisodeOfCare', ['EpisodeOfCare:patient', 'EpisodeOfCare:condition', 'EpisodeOfCare:incomingreferral', 'EpisodeOfCare:organization', 'EpisodeOfCare:care-manager']),
	('ExpansionProfile', []),
	('ExplanationOfBenefit', ['ExplanationOfBenefit:payee', 'ExplanationOfBenefit:provider', 'ExplanationOfBenefit:claim', 'ExplanationOfBenefit:patient', 'ExplanationOfBenefit:organization', 'ExplanationOfBenefit:encounter', 'ExplanationOfBenefit:coverage', 'ExplanationOfBenefit:facility', 'ExplanationOfBenefit:enterer', 'ExplanationOfBenefit:care-team']),
	('FamilyMemberHistory', ['FamilyMemberHistory:patient', 'FamilyMemberHistory:definition']),
	('Flag', ['Flag:patient', 'Flag:subject', 'Flag:author', 'Flag:encounter']),
	('Goal', ['Goal:patient', 'Goal:subject']),
	('GraphDefinition', []),
	('Group', ['Group:member']),
	('GuidanceResponse', ['GuidanceResponse:patient', 'GuidanceResponse:subject']),
	('HealthcareService', ['HealthcareService:organization', 'HealthcareService:endpoint', 'HealthcareService:location']),
	('ImagingManifest', ['ImagingManifest:patient', 'ImagingManifest:imaging-study', 'ImagingManifest:endpoint', 'ImagingManifest:author']),
	('ImagingStudy', ['ImagingStudy:patient', 'ImagingStudy:performer', 'ImagingStudy:endpoint', 'ImagingStudy:context', 'ImagingStudy:basedon']),
	('Immunization', ['Immunization:patient', 'Immunization:practitioner', 'Immunization:reaction', 'Immunization:location', 'Immunization:manufacturer']),
	('ImmunizationRecommendation', ['ImmunizationRecommendation:support', 'ImmunizationRecommendation:patient', 'ImmunizationRecommendation:information']),
	('ImplementationGuide', ['ImplementationGuide:resource']),
	('Library', ['Library:successor', 'Library:predecessor', 'Library:derived-from', 'Library:composed-of', 'Library:depends-on']),
	('Linkage', ['Linkage:author']),
	('List', ['List:patient', 'List:subject', 'List:item', 'List:source', 'List:encounter']),
	('Location', ['Location:partof', 'Location:organization', 'Location:endpoint']),
	('Measure', ['Measure:successor', 'Measure:predecessor', 'Measure:composed-of', 'Measure:derived-from', 'Measure:depends-on']),
	('MeasureReport', ['MeasureReport:patient']),
	('Media', ['Media:subject', 'Media:patient', 'Media:operator', 'Media:context', 'Media:based-on', 'Media:device']),
	('Medication', ['Medication:package-item', 'Medication:manufacturer', 'Medication:ingredient']),
	('MedicationAdministration', ['MedicationAdministration:subject', 'MedicationAdministration:prescription', 'MedicationAdministration:performer', 'MedicationAdministration:patient', 'MedicationAdministration:medication', 'MedicationAdministration:device', 'MedicationAdministration:context']),
	('MedicationDispense', ['MedicationDispense:subject', 'MedicationDispense:receiver', 'MedicationDispense:responsibleparty', 'MedicationDispense:performer', 'MedicationDispense:context', 'MedicationDispense:destination', 'MedicationDispense:prescription', 'MedicationDispense:patient', 'MedicationDispense:medication']),
	('MedicationRequest', ['MedicationRequest:requester', 'MedicationRequest:subject', 'MedicationRequest:intended-dispenser', 'MedicationRequest:context', 'MedicationRequest:patient', 'MedicationRequest:medication']),
	('MedicationStatement', ['MedicationStatement:subject', 'MedicationStatement:source', 'MedicationStatement:context', 'MedicationStatement:part-of', 'MedicationStatement:patient', 'MedicationStatement:medication']),
	('MessageDefinition', []),
	('MessageHeader', ['MessageHeader:target', 'MessageHeader:responsible', 'MessageHeader:sender', 'MessageHeader:focus', 'MessageHeader:receiver', 'MessageHeader:enterer', 'MessageHeader:author']),
	('NamingSystem', ['NamingSystem:replaced-by']),
	('NutritionOrder', ['NutritionOrder:patient', 'NutritionOrder:provider', 'NutritionOrder:encounter']),
	('Observation', ['Observation:patient', 'Observation:specimen', 'Observation:subject', 'Observation:related-target', 'Observation:performer', 'Observation:device', 'Observation:context', 'Observation:based-on', 'Observation:encounter']),
	('OperationDefinition', ['OperationDefinition:param-profile', 'OperationDefinition:base']),
	('OperationOutcome', []),
	('Organization', ['Organization:partof', 'Organization:endpoint']),
	('Parameters', []),
	('Patient', ['Patient:general-practitioner', 'Patient:organization', 'Patient:link']),
	('PaymentNotice', ['PaymentNotice:request', 'PaymentNotice:provider', 'PaymentNotice:response', 'PaymentNotice:organization']),
	('PaymentReconciliation', ['PaymentReconciliation:request', 'PaymentReconciliation:request-provider', 'PaymentReconciliation:request-organization', 'PaymentReconciliation:organization']),
	('Person', ['Person:relatedperson', 'Person:patient', 'Person:practitioner', 'Person:organization', 'Person:link']),
	('PlanDefinition', ['PlanDefinition:successor', 'PlanDefinition:predecessor', 'PlanDefinition:derived-from', 'PlanDefinition:depends-on', 'PlanDefinition:composed-of']),
	('Practitioner', []),
	('PractitionerRole', ['PractitionerRole:service', 'PractitionerRole:organization', 'PractitionerRole:practitioner', 'PractitionerRole:location', 'PractitionerRole:endpoint']),
	('Procedure', ['Procedure:patient', 'Procedure:performer', 'Procedure:subject', 'Procedure:part-of', 'Procedure:location', 'Procedure:context', 'Procedure:based-on', 'Procedure:definition', 'Procedure:encounter']),
	('ProcedureRequest', ['ProcedureRequest:patient', 'ProcedureRequest:requester', 'ProcedureRequest:replaces', 'ProcedureRequest:subject', 'ProcedureRequest:specimen', 'ProcedureRequest:performer', 'ProcedureRequest:definition', 'ProcedureRequest:based-on', 'ProcedureRequest:context', 'ProcedureRequest:encounter']),
	('ProcessRequest', ['ProcessRequest:provider', 'ProcessRequest:organization']),
	('ProcessResponse', ['ProcessResponse:request-provider', 'ProcessResponse:request', 'ProcessResponse:organization', 'ProcessResponse:request-organization']),
	('Provenance', ['Provenance:location', 'Provenance:patient', 'Provenance:target', 'Provenance:entity-ref', 'Provenance:agent']),
	('Questionnaire', []),
	('QuestionnaireResponse', ['QuestionnaireResponse:questionnaire', 'QuestionnaireResponse:subject', 'QuestionnaireResponse:source', 'QuestionnaireResponse:patient', 'QuestionnaireResponse:parent', 'QuestionnaireResponse:context', 'QuestionnaireResponse:based-on', 'QuestionnaireResponse:author']),
	('ReferralRequest', ['ReferralRequest:patient', 'ReferralRequest:recipient', 'ReferralRequest:requester', 'ReferralRequest:replaces', 'ReferralRequest:subject', 'ReferralRequest:definition', 'ReferralRequest:encounter', 'ReferralRequest:context', 'ReferralRequest:based-on']),
	('RelatedPerson', ['RelatedPerson:patient']),
	('RequestGroup', ['RequestGroup:subject', 'RequestGroup:patient', 'RequestGroup:participant', 'RequestGroup:encounter', 'RequestGroup:definition', 'RequestGroup:context', 'RequestGroup:author']),
	('ResearchStudy', ['ResearchStudy:sponsor', 'ResearchStudy:site', 'ResearchStudy:protocol', 'ResearchStudy:principalinvestigator', 'ResearchStudy:partof']),
	('ResearchSubject', ['ResearchSubject:individual', 'ResearchSubject:patient']),
	('RiskAssessment', ['RiskAssessment:patient', 'RiskAssessment:performer', 'RiskAssessment:condition', 'RiskAssessment:subject', 'RiskAssessment:encounter']),
	('Schedule', ['Schedule:actor']),
	('SearchParameter', ['SearchParameter:component']),
	('Sequence', ['Sequence:patient']),
	('ServiceDefinition', ['ServiceDefinition:successor', 'ServiceDefinition:predecessor', 'ServiceDefinition:depends-on', 'ServiceDefinition:composed-of', 'ServiceDefinition:derived-from']),
	('Slot', ['Slot:schedule']),
	('Specimen', ['Specimen:subject', 'Specimen:patient', 'Specimen:parent', 'Specimen:collector']),
	('StructureDefinition', ['StructureDefinition:valueset']),
	('StructureMap', []),
	('Subscription', []),
	('Substance', ['Substance:substance-reference']),
	('SupplyDelivery', ['SupplyDelivery:patient', 'SupplyDelivery:supplier', 'SupplyDelivery:receiver']),
	('SupplyRequest', ['SupplyRequest:supplier', 'SupplyRequest:requester']),
	('Task', ['Task:subject', 'Task:requester', 'Task:part-of', 'Task:patient', 'Task:organization', 'Task:owner', 'Task:based-on', 'Task:context', 'Task:focus']),
	('TestReport', ['TestReport:testscript']),
	('TestScript', []),
	('ValueSet', []),
	('VisionPrescription', ['VisionPrescription:patient', 'VisionPrescription:prescriber', 'VisionPrescription:encounter']) 
])



def test_search_includes(host, si_res, search_includes):
    res = get_resource(host, si_res)
    includes = set(res['searchInclude'])

    for inc in search_includes:
        assert inc in includes, f"Does searchInclude({inc})?"

