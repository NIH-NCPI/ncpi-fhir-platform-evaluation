import pytest

from fhireval.test_suite.capability_statement import get_resource, get_capability_statement

# Which bullet point do these tests map to
test_id = f"{'2.1.2':<10} - Conditional Create, Upd & Del"

# How much weight do we attribute to the tests in this file
test_weight = 5

@pytest.mark.capability_statement

# Conditional CUD
@pytest.mark.parametrize("conditional_res, conditional_cud", [
    ('Account', ('True','True','multiple') ),
    ('ActivityDefinition', ('True','True','multiple') ),
    ('AdverseEvent', ('True','True','multiple') ),
    ('AllergyIntolerance', ('True','True','multiple') ),
    ('Appointment', ('True','True','multiple') ),
    ('AppointmentResponse', ('True','True','multiple') ),
    ('AuditEvent', ('True','True','multiple') ),
    ('Basic', ('True','True','multiple') ),
    ('Binary', ('True','True','multiple') ),
    ('BodySite', ('True','True','multiple') ),
    ('Bundle', ('True','True','multiple') ),
    ('CapabilityStatement', ('True','True','multiple') ),
    ('CarePlan', ('True','True','multiple') ),
    ('CareTeam', ('True','True','multiple') ),
    ('ChargeItem', ('True','True','multiple') ),
    ('Claim', ('True','True','multiple') ),
    ('ClaimResponse', ('True','True','multiple') ),
    ('ClinicalImpression', ('True','True','multiple') ),
    ('CodeSystem', ('True','True','multiple') ),
    ('Communication', ('True','True','multiple') ),
    ('CommunicationRequest', ('True','True','multiple') ),
    ('CompartmentDefinition', ('True','True','multiple') ),
    ('Composition', ('True','True','multiple') ),
    ('ConceptMap', ('True','True','multiple') ),
    ('Condition', ('True','True','multiple') ),
    ('Consent', ('True','True','multiple') ),
    ('Contract', ('True','True','multiple') ),
    ('Coverage', ('True','True','multiple') ),
    ('DataElement', ('True','True','multiple') ),
    ('DetectedIssue', ('True','True','multiple') ),
    ('Device', ('True','True','multiple') ),
    ('DeviceComponent', ('True','True','multiple') ),
    ('DeviceMetric', ('True','True','multiple') ),
    ('DeviceRequest', ('True','True','multiple') ),
    ('DeviceUseStatement', ('True','True','multiple') ),
    ('DiagnosticReport', ('True','True','multiple') ),
    ('DocumentManifest', ('True','True','multiple') ),
    ('DocumentReference', ('True','True','multiple') ),
    ('EligibilityRequest', ('True','True','multiple') ),
    ('EligibilityResponse', ('True','True','multiple') ),
    ('Encounter', ('True','True','multiple') ),
    ('Endpoint', ('True','True','multiple') ),
    ('EnrollmentRequest', ('True','True','multiple') ),
    ('EnrollmentResponse', ('True','True','multiple') ),
    ('EpisodeOfCare', ('True','True','multiple') ),
    ('ExpansionProfile', ('True','True','multiple') ),
    ('ExplanationOfBenefit', ('True','True','multiple') ),
    ('FamilyMemberHistory', ('True','True','multiple') ),
    ('Flag', ('True','True','multiple') ),
    ('Goal', ('True','True','multiple') ),
    ('GraphDefinition', ('True','True','multiple') ),
    ('Group', ('True','True','multiple') ),
    ('GuidanceResponse', ('True','True','multiple') ),
    ('HealthcareService', ('True','True','multiple') ),
    ('ImagingManifest', ('True','True','multiple') ),
    ('ImagingStudy', ('True','True','multiple') ),
    ('Immunization', ('True','True','multiple') ),
    ('ImmunizationRecommendation', ('True','True','multiple') ),
    ('ImplementationGuide', ('True','True','multiple') ),
    ('Library', ('True','True','multiple') ),
    ('Linkage', ('True','True','multiple') ),
    ('List', ('True','True','multiple') ),
    ('Location', ('True','True','multiple') ),
    ('Measure', ('True','True','multiple') ),
    ('MeasureReport', ('True','True','multiple') ),
    ('Media', ('True','True','multiple') ),
    ('Medication', ('True','True','multiple') ),
    ('MedicationAdministration', ('True','True','multiple') ),
    ('MedicationDispense', ('True','True','multiple') ),
    ('MedicationRequest', ('True','True','multiple') ),
    ('MedicationStatement', ('True','True','multiple') ),
    ('MessageDefinition', ('True','True','multiple') ),
    ('MessageHeader', ('True','True','multiple') ),
    ('NamingSystem', ('True','True','multiple') ),
    ('NutritionOrder', ('True','True','multiple') ),
    ('Observation', ('True','True','multiple') ),
    ('OperationDefinition', ('True','True','multiple') ),
    ('OperationOutcome', ('True','True','multiple') ),
    ('Organization', ('True','True','multiple') ),
    ('Parameters', ('True','True','multiple') ),
    ('Patient', ('True','True','multiple') ),
    ('PaymentNotice', ('True','True','multiple') ),
    ('PaymentReconciliation', ('True','True','multiple') ),
    ('Person', ('True','True','multiple') ),
    ('PlanDefinition', ('True','True','multiple') ),
    ('Practitioner', ('True','True','multiple') ),
    ('PractitionerRole', ('True','True','multiple') ),
    ('Procedure', ('True','True','multiple') ),
    ('ProcedureRequest', ('True','True','multiple') ),
    ('ProcessRequest', ('True','True','multiple') ),
    ('ProcessResponse', ('True','True','multiple') ),
    ('Provenance', ('True','True','multiple') ),
    ('Questionnaire', ('True','True','multiple') ),
    ('QuestionnaireResponse', ('True','True','multiple') ),
    ('ReferralRequest', ('True','True','multiple') ),
    ('RelatedPerson', ('True','True','multiple') ),
    ('RequestGroup', ('True','True','multiple') ),
    ('ResearchStudy', ('True','True','multiple') ),
    ('ResearchSubject', ('True','True','multiple') ),
    ('RiskAssessment', ('True','True','multiple') ),
    ('Schedule', ('True','True','multiple') ),
    ('SearchParameter', ('True','True','multiple') ),
    ('Sequence', ('True','True','multiple') ),
    ('ServiceDefinition', ('True','True','multiple') ),
    ('Slot', ('True','True','multiple') ),
    ('Specimen', ('True','True','multiple') ),
    ('StructureDefinition', ('True','True','multiple') ),
    ('StructureMap', ('True','True','multiple') ),
    ('Subscription', ('True','True','multiple') ),
    ('Substance', ('True','True','multiple') ),
    ('SupplyDelivery', ('True','True','multiple') ),
    ('SupplyRequest', ('True','True','multiple') ),
    ('Task', ('True','True','multiple') ),
    ('TestReport', ('True','True','multiple') ),
    ('TestScript', ('True','True','multiple') ),
    ('ValueSet', ('True','True','multiple') ),
    ('VisionPrescription', ('True','True','multiple') )
])


def test_conditional_cud(host, conditional_res, conditional_cud):
    res = get_resource(host, conditional_res)

    assert str(res['conditionalCreate']) == conditional_cud[0]
    assert str(res['conditionalUpdate']) == conditional_cud[1]
    assert str(res['conditionalDelete']) == conditional_cud[2]


